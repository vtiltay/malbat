{% extends "familytree/base.html" %}
{% load i18n %}

{% block title %}{% trans "Propose Modification" %}{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-lg mb-4">
                <div class="card-body p-5">
                    <h1 class="h3 mb-2">
                        <i class="bi bi-pencil-square"></i> {% trans "Propose Modification" %}
                    </h1>
                    <p class="text-muted mb-4">
                        {% trans "For complex modifications, use this advanced form with JSON format." %}
                    </p>
                    
                    <form method="post" novalidate>
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="{{ form.action.id_for_label }}" class="form-label">
                                <i class="bi bi-tag"></i> {{ form.action.label }}
                            </label>
                            <select name="action" id="{{ form.action.id_for_label }}" class="form-select {% if form.action.errors %}is-invalid{% endif %}" required>
                                <option value="">{% trans "Select an action" %}</option>
                                {% for value, label in form.action.field.choices %}
                                    {% if value %}
                                        <option value="{{ value }}" {% if form.action.value == value %}selected{% endif %}>{{ label }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            {% if form.action.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.action.errors %}
                                        <i class="bi bi-exclamation-circle"></i> {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.entity_type.id_for_label }}" class="form-label">
                                <i class="bi bi-box"></i> {{ form.entity_type.label }}
                            </label>
                            <select name="entity_type" id="{{ form.entity_type.id_for_label }}" class="form-select {% if form.entity_type.errors %}is-invalid{% endif %}" required>
                                <option value="">{% trans "Select a type" %}</option>
                                {% for value, label in form.entity_type.field.choices %}
                                    {% if value %}
                                        <option value="{{ value }}" {% if form.entity_type.value == value %}selected{% endif %}>{{ label }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            {% if form.entity_type.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.entity_type.errors %}
                                        <i class="bi bi-exclamation-circle"></i> {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.person.id_for_label }}" class="form-label">
                                <i class="bi bi-person"></i> {{ form.person.label }}
                            </label>
                            <select name="person" id="{{ form.person.id_for_label }}" class="form-select {% if form.person.errors %}is-invalid{% endif %}">
                                <option value="">{% trans "Select a person (optional)" %}</option>
                                {% for value, label in form.person.field.choices %}
                                    {% if value %}
                                        <option value="{{ value }}" {% if form.person.value == value %}selected{% endif %}>{{ label }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            {% if form.person.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.person.errors %}
                                        <i class="bi bi-exclamation-circle"></i> {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.entity_id.id_for_label }}" class="form-label">
                                <i class="bi bi-code"></i> {{ form.entity_id.label }}
                            </label>
                            <input 
                                type="text" 
                                name="entity_id" 
                                id="{{ form.entity_id.id_for_label }}" 
                                class="form-control {% if form.entity_id.errors %}is-invalid{% endif %}"
                                placeholder="{% trans 'Example: I0001' %}"
                            >
                            <small class="text-muted">{% trans "Entity ID (e.g. I0001)" %}</small>
                            {% if form.entity_id.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.entity_id.errors %}
                                        <i class="bi bi-exclamation-circle"></i> {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-4">
                            <label for="{{ form.data.id_for_label }}" class="form-label">
                                <i class="bi bi-file-code"></i> {{ form.data.label }}
                            </label>
                            <textarea 
                                name="data" 
                                id="{{ form.data.id_for_label }}" 
                                class="form-control {% if form.data.errors %}is-invalid{% endif %}"
                                rows="6"
                                placeholder='{"first_name": "John", "birth_date": "1990-01-15"}'
                            ></textarea>
                            <small class="text-muted">
                                {% trans "JSON format with fields to add/modify." %}<br>
                                {% trans "Example" %}: <code>{"first_name": "John", "birth_date": "1990-01-15"}</code>
                            </small>
                            {% if form.data.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.data.errors %}
                                        <i class="bi bi-exclamation-circle"></i> {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="d-grid gap-2 d-sm-flex">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-send"></i> {% trans "Send Proposal" %}
                            </button>
                            <a href="{% url 'home' %}" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle"></i> {% trans "Cancel" %}
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Alternatives Section -->
            <div class="alert alert-info border-start border-info border-3">
                <h5 class="alert-heading">
                    <i class="bi bi-lightbulb"></i> {% trans "Quick Forms" %}
                </h5>
                <p class="mb-2">{% trans "To quickly add a spouse or child, go to a person's page and use the available buttons." %}</p>
                <a href="{% url 'home' %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-arrow-left"></i> {% trans "Back to Home" %}
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
